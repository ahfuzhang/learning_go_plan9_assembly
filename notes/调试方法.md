
1. 安装调试器

```bash
go install github.com/go-delve/delve/cmd/dlv@latest
```

> 假定被测试的代码是一个测试用例

```go
func Test_Load256Bits_1(t *testing.T) {
	arr := []int64{1, 2, 3, 4, 5}
	t.Logf("%+v", Load256Bits(arr))
}
```

2. 命令行运行调试器

```bash
~/go/bin/dlv test -- -test.run ^Test_Load256Bits_1$
```

3. 设置断点

在 dlv 中设置 Test_XX 函数为断点。(必须加)
对自己编写的函数也设置断点。

```text
break Test_Load256Bits_1
b Load256Bits
```

4. 运行测试

输入 c 或者 continue， 运行到第一个断点 `Test_Load256Bits_1`。
再按一次 c，运行到第二个断点 `Load256Bits`。

5. 单步运行

输入 n 或者 next，单步执行。

6. 查看寄存器

regs 可以查看所有寄存器

* 如何查看 256 bit 的 Y 系列寄存器？
  - 在某行代码后面加上调试代码 `VMOVDQU Y3, 0(SP)`
  - 把 256 bit 的寄存器值写到堆栈 sp 上
  - 单步运行到 `VMOVDQU Y3, 0(SP)` 之后
  - 通过 `regs` 查看到 `Rsp = 0x000000c00010ae20`
  - 这个命令可以看到 Y3 寄存器的内容: `x -count 32 -fmt hex 0x000000c00010ae20`
  - 调试完成后，删除调试代码：`VMOVDQU Y3, 0(SP)`

7. 启动 dlv 后自动执行命令

```bash
echo "break Test_Load256Bits_1" > command.txt
~/go/bin/dlv test --init command.txt -- -test.run ^Test_Load256Bits_1$
```
